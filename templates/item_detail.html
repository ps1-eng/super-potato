{% extends 'base.html' %}

{% block content %}
<section class="card">
  <h2>Add a listing</h2>
  <form class="grid listing-grid" method="post" action="{{ url_for('add_listing', item_id=item.id) }}">
    <label>
      eBay URL
      <input type="url" name="ebay_url" placeholder="https://" />
    </label>
    <label>
      Adverts.ie URL
      <input type="url" name="adverts_url" placeholder="https://" />
    </label>
    <label>
      Vinted URL
      <input type="url" name="vinted_url" placeholder="https://" />
    </label>
    <label>
      SKU
      <input type="text" name="sku" value="{{ item.sku or '' }}" required />
    </label>
    <label>
      Listing date
      <input
        type="date"
        name="listing_date"
        class="date-input"
        placeholder="26/03/2024"
        value="{{ '' | today_input }}"
        required
      />
    </label>
    <button type="submit" class="primary">Add listing</button>
  </form>
</section>

<section class="card">
  <h2>Mark as sold</h2>
  <form class="grid" method="post" action="{{ url_for('mark_sold', item_id=item.id) }}">
    <label>
      Sale price (€)
      <input type="number" step="0.01" name="sale_price" required />
    </label>
    <label>
      Sale date
      <input
        type="date"
        name="sale_date"
        class="date-input"
        placeholder="26/03/2024"
        value="{{ '' | today_input }}"
        required
      />
    </label>
    <label>
      Sold marketplace
      <select name="sold_marketplace" required>
        {% for option in marketplaces %}
          <option value="{{ option }}">{{ option }}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit" class="primary">Mark sold</button>
  </form>
</section>

<section class="card">
  <div class="item-header">
    <div>
      <h2>{{ item.name }}</h2>
      <p class="muted">Purchased from {{ item.purchase_source }} on {{ item.purchase_date }}</p>
    </div>
    <a class="link" href="{{ url_for('index') }}">Back to items</a>
  </div>
  <div class="detail-grid">
    <div>
      <h3>Item details</h3>
      <ul>
        <li>Status: <strong>{{ item.status }}</strong></li>
        <li>Listed date: {{ item.listed_date or '–' }}</li>
        <li>SKU: {{ item.sku or '–' }}</li>
        <li>Purchase price: {{ item.purchase_price | currency }}</li>
        <li>Purchase date: {{ item.purchase_date }}</li>
        <li>Purchase source: {{ item.purchase_source }}</li>
        <li>Box: {% if item.lot_id %}<a href="{{ url_for('lot_detail', lot_id=item.lot_id) }}">{{ item.lot_reference }}</a>{% else %}–{% endif %}</li>
        <li>Description: {{ item.description or '–' }}</li>
        <li>Notes: {{ item.notes or '–' }}</li>
      </ul>
    </div>
    <div>
      <h3>Sale details</h3>
      <ul>
        <li>Sale price: {{ item.sale_price | currency }}</li>
        <li>Sale date: {{ item.sale_date or '–' }}</li>
        <li>Sold on: {{ item.sold_marketplace or '–' }}</li>
      </ul>
    </div>
  </div>
</section>

<section class="card">
  <h2>Listings</h2>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Marketplace</th>
          <th>Listing URL</th>
          <th>Date listed</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for listing in listings %}
          <tr>
            <td>{{ listing.marketplace }}</td>
            <td><a href="{{ listing.listing_url }}" target="_blank" rel="noopener">{{ listing.listing_url }}</a></td>
            <td>{{ listing.listing_date or '–' }}</td>
            <td><a href="{{ url_for('edit_listing', listing_id=listing.id) }}">Edit</a></td>
          </tr>
        {% else %}
          <tr>
            <td colspan="4" class="empty">No listings yet.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if listings %}
    <a class="button" href="{{ url_for('open_listings', item_id=item.id) }}">Open all listings</a>
  {% endif %}
</section>

<section class="card">
  <h2>Delete item</h2>
  <p class="muted">This removes the item and all associated listings.</p>
  <form
    method="post"
    action="{{ url_for('delete_item', item_id=item.id) }}"
    onsubmit="return confirm('Delete this item and all its listings?');"
  >
    <button type="submit" class="button">Delete item</button>
  </form>
</section>
{% endblock %}
